<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="ZX Spectrum emulator for the browser"
        />
        <meta name="theme-color" content="#0a0a0b" />
        <title>ZX Spectrum Emulator</title>
    </head>
    <body>
        <div id="app">
            <header>
                <div class="header-left">
                    <span class="header-logo"
                        ><span class="logo-r">S</span
                        ><span class="logo-w">pect</span
                        ><span class="logo-y">r</span
                        ><span class="logo-g">E</span
                        ><span class="logo-c">m</span></span
                    >
                    <span class="version-chip"></span>
                </div>
                <nav class="header-controls">
                    <!-- Action buttons: immediate actions with borders -->
                    <div class="control-group">
                        <button
                            id="btn-power"
                            class="control-btn power-btn off"
                            title="Power On"
                        >
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path d="M12 2v10M18.4 6.6a9 9 0 1 1-12.8 0" />
                            </svg>
                        </button>

                        <button
                            id="btn-reset"
                            class="control-btn disabled"
                            title="Reset"
                            aria-label="Reset"
                        >
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path d="M1 4v6h6" />
                                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" />
                            </svg>
                        </button>

                        <button
                            id="btn-fullscreen"
                            class="control-btn"
                            title="Fullscreen"
                            aria-label="Fullscreen"
                        >
                            <svg
                                class="icon-expand"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"
                                />
                            </svg>
                            <svg
                                class="icon-compress hidden"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M4 14h6v6M20 10h-6V4M14 10l7-7M3 21l7-7"
                                />
                            </svg>
                        </button>
                    </div>

                    <!-- Divider between action buttons and menus -->
                    <div class="header-divider"></div>

                    <!-- File menu -->
                    <div class="header-menu-container" id="file-menu-container">
                        <button class="header-menu-trigger" id="btn-file-menu">
                            <span>File</span>
                            <svg
                                class="menu-chevron"
                                viewBox="0 0 12 12"
                                width="10"
                                height="10"
                            >
                                <path
                                    d="M3 5l3 3 3-3"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.5"
                                />
                            </svg>
                        </button>
                        <div class="header-menu" id="file-menu">
                            <button
                                class="header-menu-item"
                                id="btn-load-snapshot"
                            >
                                <span>Load Snapshot...</span>
                            </button>
                            <button
                                class="header-menu-item"
                                id="btn-save-states"
                            >
                                <span>Save States...</span>
                            </button>
                            <div class="header-menu-separator"></div>
                            <button
                                class="header-menu-item menu-check-item"
                                id="btn-autosave-toggle"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>Auto Save</span>
                            </button>
                        </div>
                    </div>

                    <!-- Machine menu -->
                    <div
                        class="header-menu-container"
                        id="machine-menu-container"
                    >
                        <button
                            class="header-menu-trigger"
                            id="btn-machine-menu"
                        >
                            <span>Machine</span>
                            <svg
                                class="menu-chevron"
                                viewBox="0 0 12 12"
                                width="10"
                                height="10"
                            >
                                <path
                                    d="M3 5l3 3 3-3"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.5"
                                />
                            </svg>
                        </button>
                        <div class="header-menu" id="machine-menu">
                            <div class="header-menu-section-label">Model</div>
                            <button
                                class="header-menu-item menu-check-item active"
                                data-machine="0"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>ZX Spectrum 48K</span>
                            </button>
                            <button
                                class="header-menu-item menu-check-item"
                                data-machine="1"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>ZX Spectrum 128K</span>
                            </button>
                            <div class="header-menu-separator"></div>
                            <div
                                class="header-menu-section-label"
                                id="options-48k-label"
                            >
                                48K Options
                            </div>
                            <button
                                class="header-menu-item menu-check-item option-48k"
                                id="btn-issue2"
                                data-issue="2"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>Issue 2 Motherboard</span>
                            </button>
                            <button
                                class="header-menu-item menu-check-item active option-48k"
                                id="btn-issue3"
                                data-issue="3"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>Issue 3 Motherboard</span>
                            </button>
                            <button
                                class="header-menu-item menu-check-item option-48k"
                                id="btn-ay-toggle"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>AY Sound Chip</span>
                            </button>
                        </div>
                    </div>

                    <!-- View menu -->
                    <div class="header-menu-container" id="view-menu-container">
                        <button class="header-menu-trigger" id="btn-view-menu">
                            <span>View</span>
                            <svg
                                class="menu-chevron"
                                viewBox="0 0 12 12"
                                width="10"
                                height="10"
                            >
                                <path
                                    d="M3 5l3 3 3-3"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.5"
                                />
                            </svg>
                        </button>
                        <div class="header-menu" id="view-menu">
                            <div class="header-menu-item theme-selector-row">
                                <span>Theme</span>
                                <div class="theme-btn-group">
                                    <button
                                        class="theme-btn"
                                        data-theme="light"
                                        title="Light"
                                    >
                                        <svg
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                        >
                                            <circle cx="12" cy="12" r="5" />
                                            <path
                                                d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                                            />
                                        </svg>
                                    </button>
                                    <button
                                        class="theme-btn"
                                        data-theme="dark"
                                        title="Dark"
                                    >
                                        <svg
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                        >
                                            <path
                                                d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                                            />
                                        </svg>
                                    </button>
                                    <button
                                        class="theme-btn"
                                        data-theme="system"
                                        title="System"
                                    >
                                        <svg
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                        >
                                            <rect
                                                x="2"
                                                y="3"
                                                width="20"
                                                height="14"
                                                rx="2"
                                                ry="2"
                                            />
                                            <line
                                                x1="8"
                                                y1="21"
                                                x2="16"
                                                y2="21"
                                            />
                                            <line
                                                x1="12"
                                                y1="17"
                                                x2="12"
                                                y2="21"
                                            />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="header-menu-separator"></div>
                            <button
                                class="header-menu-item menu-check-item"
                                id="btn-display"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>Display</span>
                            </button>
                            <button
                                class="header-menu-item menu-check-item"
                                id="btn-tape-player"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>Tape Player</span>
                            </button>
                            <button
                                class="header-menu-item menu-check-item"
                                id="btn-sound-debug"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>Audio</span>
                            </button>
                            <button
                                class="header-menu-item menu-check-item"
                                id="btn-memory-map"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>Memory Map</span>
                            </button>
                        </div>
                    </div>

                    <!-- Dev menu -->
                    <div class="header-menu-container" id="dev-menu-container">
                        <button class="header-menu-trigger" id="btn-dev-menu">
                            <span>Dev</span>
                            <svg
                                class="menu-chevron"
                                viewBox="0 0 12 12"
                                width="10"
                                height="10"
                            >
                                <path
                                    d="M3 5l3 3 3-3"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.5"
                                />
                            </svg>
                        </button>
                        <div class="header-menu" id="dev-menu">
                            <button
                                class="header-menu-item menu-check-item"
                                id="btn-z80-debug"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>Z80 Debugger</span>
                            </button>
                            <button
                                class="header-menu-item menu-check-item"
                                id="btn-stack-viewer"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>Stack Viewer</span>
                            </button>
                            <button
                                class="header-menu-item menu-check-item"
                                id="btn-basic-editor"
                            >
                                <span class="menu-check">&#10003;</span>
                                <span>BASIC Editor</span>
                            </button>
                        </div>
                    </div>

                    <!-- Divider between menu zone and panel triggers -->
                    <div class="header-divider"></div>

                    <!-- Panel triggers: open popups, styled like menu triggers -->
                    <div class="panel-trigger-group">
                        <div class="speed-control-wrapper">
                            <button
                                id="btn-speed"
                                class="icon-menu-trigger"
                                title="Speed"
                                aria-label="Speed"
                            >
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <polyline points="13 17 18 12 13 7" />
                                    <polyline points="6 17 11 12 6 7" />
                                </svg>
                                <svg
                                    class="menu-chevron"
                                    viewBox="0 0 12 12"
                                    width="8"
                                    height="8"
                                >
                                    <path
                                        d="M3 5l3 3 3-3"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                    />
                                </svg>
                            </button>
                            <div id="speed-popup" class="speed-popup">
                                <div class="speed-popup-row">
                                    <label for="speed-slider">Speed</label>
                                    <input
                                        type="range"
                                        id="speed-slider"
                                        min="1"
                                        max="5"
                                        step="1"
                                        value="1"
                                    />
                                    <span id="speed-value" aria-live="polite"
                                        >1x</span
                                    >
                                </div>
                            </div>
                        </div>
                        <div class="sound-control-wrapper">
                            <button
                                id="btn-sound"
                                class="icon-menu-trigger"
                                title="Sound Settings"
                                aria-label="Sound Settings"
                            >
                                <svg
                                    class="icon-unmuted"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path d="M11 5L6 9H2v6h4l5 4V5z" />
                                    <path
                                        d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"
                                    />
                                </svg>
                                <svg
                                    class="icon-muted hidden"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path d="M11 5L6 9H2v6h4l5 4V5z" />
                                    <line x1="23" y1="9" x2="17" y2="15" />
                                    <line x1="17" y1="9" x2="23" y2="15" />
                                </svg>
                                <svg
                                    class="menu-chevron"
                                    viewBox="0 0 12 12"
                                    width="8"
                                    height="8"
                                >
                                    <path
                                        d="M3 5l3 3 3-3"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.5"
                                    />
                                </svg>
                            </button>
                            <div id="sound-popup" class="sound-popup">
                                <div class="sound-popup-row">
                                    <label for="volume-slider">Volume</label>
                                    <input
                                        type="range"
                                        id="volume-slider"
                                        min="0"
                                        max="100"
                                        value="50"
                                    />
                                    <span id="volume-value" aria-live="polite"
                                        >50%</span
                                    >
                                </div>
                                <div class="sound-popup-row">
                                    <label>Mute</label>
                                    <label class="toggle-switch">
                                        <input
                                            type="checkbox"
                                            id="mute-toggle"
                                        />
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
            </header>

            <main>
                <div class="emulator-section">
                    <div id="monitor-frame">
                        <canvas id="screen"></canvas>
                    </div>
                </div>
            </main>

            <div id="loading">
                <p>Initializing ZX Spectrum...</p>
            </div>
        </div>

        <script type="module" src="/src/js/main.js"></script>
    </body>
</html>
